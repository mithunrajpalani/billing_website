{% extends 'base.html' %}

{% block content %}
<div class="card">
    <h2>Shop Settings</h2>
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="qr_code">Payment QR Code (UPI/Bank)</label>
            <div
                style="display: flex; align-items: center; gap: 20px; background: rgba(255, 255, 255, 0.5); padding: 15px; border-radius: 12px; border: 1px dashed var(--accent-color);">
                <div style="flex: 1;">
                    <input type="file" id="qr_code" name="qr_code" accept="image/*" style="border: none; padding: 0;">
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;">Upload PNG or JPG image of
                        your payment QR code.</p>
                </div>
                {% if settings.qr_code_path %}
                <div style="text-align: center;">
                    <p style="font-size: 0.75rem; margin-bottom: 5px; font-weight: 600;">Current QR:</p>
                    <img src="{{ url_for('serve_upload', filename=settings.qr_code_path) }}" alt="QR Code"
                        style="height: 60px; border-radius: 5px; border: 1px solid #ddd;">
                </div>
                {% endif %}
            </div>
        </div>
        <div class="form-group">
            <label for="company_name">Company Name</label>
            <input type="text" id="company_name" name="company_name" value="{{ settings.company_name }}" required>
        </div>
        <div class="form-group">
            <label for="shop_name">Shop Name</label>
            <input type="text" id="shop_name" name="shop_name" value="{{ settings.shop_name }}" required>
        </div>
        <div class="form-group">
            <label for="address">Shop Address</label>
            <textarea id="address" name="address" rows="3">{{ settings.address }}</textarea>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label for="mobile">Mobile Number 1</label>
                <input type="text" id="mobile" name="mobile" value="{{ settings.mobile }}">
            </div>
            <div class="form-group">
                <label for="mobile2">Mobile Number 2</label>
                <input type="text" id="mobile2" name="mobile2" value="{{ settings.mobile2 }}">
            </div>
        </div>

        <h3 style="margin: 30px 0 15px;">Add New Item</h3>
        <div
            style="background: rgba(78, 204, 163, 0.05); padding: 25px; border-radius: 15px; margin-bottom: 35px; border: 1px solid rgba(78, 204, 163, 0.1);">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="new_item_name">Item Name</label>
                    <input type="text" id="new_item_name" name="new_item_name" placeholder="e.g. Mixing Fruits">
                </div>
                <div class="form-group">
                    <label for="new_item_price">Price (â‚¹)</label>
                    <input type="number" id="new_item_price" name="new_item_price" step="0.01" value="0">
                </div>
            </div>

            <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: flex-end; margin-top: 15px;">
                <div class="form-group">
                    <label for="new_item_category">Category</label>
                    <select id="new_item_category" name="new_item_category">
                        <option value="Main">Main</option>
                        <option value="Ice Cream">Ice Cream</option>
                        <option value="Fruits">Fruits</option>
                        <option value="Beeda">Beeda</option>
                        <option value="Welcome Drinks">Welcome Drinks</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <input type="checkbox" id="is_sub_item" name="is_sub_item" style="width: auto;">
                    <label for="is_sub_item" style="margin-bottom: 0;">Is Sub-item (e.g. flavor/fruit type)</label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary" style="margin-top: 15px; width: 100%;">Add Item</button>
        </div>
        <p style="margin: -25px 0 35px; font-size: 0.85rem; color: var(--text-muted); padding-left: 5px;">* New items
            are added to the "Main" category. Click 'Add Item' to save.</p>

        <h3 style="margin: 30px 0 15px;">Item Prices</h3>

        {% set categories = ['Main', 'Ice Cream', 'Fruits', 'Beeda', 'Welcome Drinks'] %}
        {% for cat in categories %}
        <h4 style="margin: 20px 0 10px; color: var(--accent-color);">{{ cat }} Items</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            {% for item in items %}
            {% if item.category == cat %}
            <div class="form-group" style="display: flex; gap: 10px; align-items: flex-end;">
                <div style="flex-grow: 1;">
                    <label>{{ item.name }}{{ ' (Sub-item)' if item.is_flavor else '' }}</label>
                    <input type="number" name="price_{{ item.id }}" value="{{ item.price }}" step="0.01">
                </div>
                <button type="submit" formaction="{{ url_for('delete_item', item_id=item.id) }}"
                    onclick="return confirm('Are you sure you want to delete {{ item.name }}?')" class="btn"
                    style="background-color: #ffebee; color: #c62828; margin-bottom: 2px;">
                    Delete
                </button>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endfor %}

        <h3 style="margin: 40px 0 15px; padding-top: 30px; border-top: 1px solid var(--border-color);">Account
            Management</h3>
        <p style="margin-bottom: 20px; font-size: 0.85rem; color: var(--text-muted);">Leave password fields blank if you
            don't want to change your password.</p>

        <div class="form-group">
            <label for="new_username">User Name</label>
            <input type="text" id="new_username" name="new_username" value="{{ current_user.username }}">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label for="current_password">Current Password</label>
                <input type="password" id="current_password" name="current_password"
                    placeholder="Required to change credentials">
            </div>
            <div class="form-group">
                <label for="new_password">New Password</label>
                <input type="password" id="new_password" name="new_password" placeholder="Enter new password">
            </div>
        </div>

        <button type="submit" class="btn btn-primary" style="margin-top: 20px; width: 100%;">Save All Changes</button>
    </form>
</div>
{% endblock %}